#include <datetime.h>
#include <stdbool.h>
#include <furi.h>

#define RAILWAY_NUM 4

typedef enum {
    SuicaKeikyu,
    SuicaTokyoMetro,
    SuicaToei,
    SuicaEastJR,
    SuicaRailwayTypeMax,
} SuicaRailwayType;

typedef enum {
    SuicaBalanceAdd,
    SuicaBalanceSub,
    SuicaBalanceEqual,
} SuicaBalanceChangeSign;

typedef struct {
    uint8_t station_code;
    uint8_t station_number;
    const char* name;
} Station;

typedef struct {
    uint8_t line_code;
    Station* line;
    const char* short_name;
    const char* long_name;
    uint8_t station_num;
    SuicaRailwayType type;
} Railway;

typedef struct {
    Railway entry_line;
    Station entry_station;
    Railway exit_line;
    Station exit_station;
    uint8_t year;
    uint8_t month;
    uint8_t day;
    uint8_t hour;
    uint8_t minute;
    uint16_t balance;
    uint8_t history_type;
    uint8_t area_code;
    uint16_t previous_balance;
    uint16_t balance_change;
    SuicaBalanceChangeSign balance_sign;
} SuicaTravelHistory;

// Station
static Station KeikyuAirport[] = {
    {0x01, 11, "Keikyu Kamata"},
    {0x02, 12, "Kojiya"},
    {0x03, 13, "Otorii"},
    {0x04, 14, "Anamori-Inari"},
    {0x05, 15, "Tenkubashi"},
    {0x06, 16, "Haneda-Airport"},
};

static Station KeikyuMain[] = {
    {0x01, 7, "Sengakuji"},
    {0x02, 1, "Shinagawa"},
    {0x03, 2, "Kita-Shinagawa"},
    {0x04, 3, "Shimbamba"},
    {0x06, 4, "Aomono-yokocho"},
    {0x07, 5, "Samezu"},
    {0x08, 6, "Tachiaigawa"},
    {0x09, 7, "Omorikaigan"},
    {0x0A, 8, "Heiwajima"},
    {0x0B, 9, "Omorimachi"},
    {0x0C, 10, "Umeyashiki"},
    {0x0D, 11, "Keikyu Kamata"},
    {0x0E, 18, "Zoshiki"},
    {0x0F, 19, "Rokugodote"},
    {0x10, 20, "Keikyu Kawasaki"},
    {0x11, 27, "Hatcho-nawate"},
    {0x12, 28, "Tsurumi-ichiba"},
    {0x13, 29, "Keikyu Tsurumi"},
    {0x14, 30, "Kagetsu-sojiji"},
    {0x15, 31, "Namamugi"},
    {0x16, 32, "Keikyu Shinkoyasu"},
    {0x17, 33, "Koyasu"},
    {0x18, 34, "Kanagawa-shimmachi"},
    {0x19, 35, "KK Higashi-kanagawa"},
    {0x1A, 36, "Kanagawa"},
    {0x1B, 37, "Yokohama"},
    {0x1C, 38, "Tobe"},
    {0x1D, 39, "Hinodecho"},
    {0x1E, 40, "Koganecho"},
    {0x1F, 41, "Minamiota"},
    {0x20, 42, "Idogaya"},
    {0x21, 43, "Gumyoji"},
    {0x22, 44, "Kamiooka"},
    {0x24, 45, "Byobugaura"},
    {0x25, 46, "Sugita"},
    {0x27, 47, "Keikyu Tomioka"},
    {0x28, 48, "Nokendai"},
    {0x29, 49, "Kanazawa-bunko"},
    {0x2A, 50, "Kanazawa-hakkei"},
    {0x2B, 54, "Oppama"},
    {0x2C, 55, "Keikyu Taura"},
    {0x2E, 56, "Anjinzuka"},
    {0x2F, 57, "Hemi"},
    {0x30, 58, "Shioiri"},
    {0x31, 59, "Yokosuka-chuo"},
    {0x32, 60, "Kenritsudaigaku"},
    {0x33, 61, "Horinouchi"},
    {0x34, 62, "Keikyu Otsu"},
    {0x35, 63, "Maborikaigan"},
    {0x36, 64, "Uraga"},
};

static Station TokyoMetroGinza[] = {
    {0x2C, 19, "Asakusa"},       {0x2D, 18, "Tawaramachi"},   {0x2E, 17, "Inaricho"},
    {0x2F, 16, "Ueno"},          {0x30, 15, "Ueno-hirokoji"}, {0x31, 14, "Suehirocho"},
    {0x32, 13, "Kanda"},         {0x33, 12, "Mitsukoshimae"}, {0x34, 11, "Nihombashi"},
    {0x35, 10, "Kyobashi"},      {0x36, 9, "Ginza"},          {0x37, 8, "Shimbashi"},
    {0x38, 7, "Toranomon"},      {0x39, 6, "Tameike-sannō"},  {0x3A, 5, "Akasaka-mitsuke"},
    {0x3B, 4, "Aoyama-itchōme"}, {0x3C, 3, "Gaiemmae"},       {0x3D, 2, "Omote-sandō"},
    {0x3E, 1, "Shibuya"},
};

static Station ToeiAsakusa[] = {
    {0x01, 20, "Oshiage"},       {0x02, 19, "Honjo-azumabashi"}, {0x03, 18, "Asakusa"},
    {0x04, 17, "Kuramae"},       {0x05, 16, "Asakusabashi"},     {0x06, 15, "Higashi-nihombashi"},
    {0x07, 14, "Ningyocho"},     {0x08, 13, "Nihombashi"},       {0x09, 12, "Takaracho"},
    {0x0A, 11, "Higashi-ginza"}, {0x0B, 10, "Shimbashi"},        {0x0C, 9, "Daimon"},
    {0x0D, 8, "Mita"},           {0x0E, 7, "Sengakuji"},         {0x0F, 6, "Takanawadai"},
    {0x10, 5, "Gotanda"},        {0x11, 4, "Togoshi"},           {0x12, 3, "Nakanobu"},
    {0x13, 2, "Magome"},         {0x14, 1, "Nishi-magome"},
};

// Railway
static Railway RailwaysList[] = {
    {0xD5, KeikyuMain, "KK", "Keikyu Main", 6, SuicaKeikyu},
    {0xD6, KeikyuAirport, "KK", "Keikyu Airport", 50, SuicaKeikyu},
    {0xE3, TokyoMetroGinza, "G", "Ginza", 19, SuicaTokyoMetro},
    {0xEF, ToeiAsakusa, "A", "Asakusa", 20, SuicaToei},
};

static const uint8_t ArrowRight[] = {0x00, 0x06, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x12, 0x00,
                               0x00, 0x22, 0x00, 0xfe, 0x4b, 0x00, 0x01, 0x98, 0x00,
                               0xfd, 0x3f, 0x01, 0xfd, 0x7f, 0x02, 0xfd, 0x3f, 0x01,
                               0x01, 0x98, 0x00, 0xfe, 0x4b, 0x00, 0x00, 0x22, 0x00,
                               0x00, 0x12, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x06, 0x00};

static const uint8_t ArrowUp[] = {0x80, 0x00, 0x40, 0x01, 0x20, 0x02, 0x90, 0x04, 0xc8,
                            0x09, 0xe4, 0x13, 0xf2, 0x27, 0xc1, 0x41, 0xdf, 0x7d,
                            0xd0, 0x05, 0xd0, 0x05, 0xd0, 0x05, 0xd0, 0x05, 0xd0,
                            0x05, 0xd0, 0x05, 0xd0, 0x05, 0x10, 0x04, 0xe0, 0x03};

static const uint8_t JRLogo[] = {0x00, 0xfe, 0x3f, 0x00, 0xfe, 0x7f, 0x00, 0xfe, 0x7f, 0x00, 0x0e, 0x70,
                           0x00, 0x0e, 0x70, 0x07, 0xee, 0x7f, 0x07, 0xce, 0x3f, 0x07, 0x8e, 0x03,
                           0x0f, 0x0f, 0x07, 0xff, 0x0f, 0x0f, 0xfe, 0x07, 0x1e, 0xfc, 0x03, 0x3c};

static const uint8_t TokyoMetroLogo[] = {0x1e, 0x00, 0x0f, 0x7f, 0xc0, 0x1f, 0xff, 0xe0, 0x1f, 0x8f,
                                   0x31, 0x1e, 0x07, 0x1f, 0x1c, 0x07, 0x0e, 0x1c, 0x0f, 0x0a,
                                   0x1e, 0x0e, 0x1b, 0x0e, 0x9e, 0x31, 0x0f, 0x9e, 0x31, 0x0f,
                                   0xbc, 0xbf, 0x07, 0x3c, 0x9f, 0x07, 0x18, 0x00, 0x03};

static const uint8_t ToeiLogo[] = {0xc0, 0x07, 0x00, 0xf0, 0x1f, 0x00, 0xf8, 0x3f, 0x00,
                             0xfc, 0x7f, 0x00, 0xfe, 0xff, 0x00, 0xfe, 0xff, 0x00,
                             0xff, 0xff, 0x01, 0xff, 0xff, 0x01, 0xfe, 0xff, 0x00,
                             0xf8, 0x3f, 0x00, 0xe0, 0x0f, 0x00, 0xc0, 0x07, 0x00,
                             0x80, 0x03, 0x00, 0x00, 0x01, 0x00, 0x00, 0x01, 0x00};

static const uint8_t DashLine[] =
    {0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77};

static const uint8_t YenSign[] = {0x07, 0x0e, 0x0e, 0x07, 0x0e, 0x07, 0x9c, 0x03, 0x9c, 0x03, 0xf8,
                            0x01, 0xf0, 0x00, 0xfe, 0x07, 0xfe, 0x07, 0x60, 0x00, 0xfe, 0x07,
                            0xfe, 0x07, 0x60, 0x00, 0x60, 0x00, 0x60, 0x00, 0x60, 0x00};

static const uint8_t YenKanji[] = {0xff, 0xff, 0xff, 0xff, 0x83, 0xc1, 0x83, 0xc1, 0x83, 0xc1, 0x83,
                             0xc1, 0xff, 0xff, 0xff, 0xff, 0x03, 0xc0, 0x03, 0xc0, 0x03, 0xc0,
                             0x03, 0xc0, 0x03, 0xc0, 0x03, 0xc0, 0x03, 0xf8, 0x03, 0x78};

static const uint8_t PlusSign1[] = {0xf0,0x03,0x10,0x02,0xd0,0x02,0xd0,0x02,0xdf,0x3e,0xc1,0x20,0xfd,0x2f,0xfd,0x2f,0xc1,0x20,0xdf,0x3e,0xd0,0x02,0xd0,0x02,0x10,0x02,0xf0,0x03};

static const uint8_t PlusSign2[] = {0xf0,0x0f,0x10,0x08,0x10,0x08,0x90,0x09,0x9f,0xf9,0x81,0x81,0x81,0x81,0xf9,0x9f,0xf9,0x9f,0x81,0x81,0x81,0x81,0x9f,0xf9,0x90,0x09,0x10,0x08,0x10,0x08,0xf0,0x0f};

static const uint8_t PlusSign3[] = {0xf0,0x3f,0x00,0x10,0x20,0x00,0x10,0x20,0x00,0x10,0x20,0x00,0x1f,0xe3,0x03,0x01,0x03,0x02,0x01,0x03,0x02,0x01,0x03,0x02,0xf1,0x3f,0x02,0xf1,0x3f,0x02,0x01,0x03,0x02,0x01,0x03,0x02,0x01,0x03,0x02,0x1f,0xe3,0x03,0x10,0x20,0x00,0x10,0x20,0x00,0x10,0x20,0x00,0xf0,0x3f,0x00};

static const uint8_t MinusSign0[] = {0xff,0x3f,0x01,0x20,0xfd,0x2f,0xfd,0x2f,0x01,0x20,0xff,0x3f};

static const uint8_t MinusSign1[] = {0xff,0x3f,0x01,0x20,0xfd,0x27,0xfd,0x27,0x01,0x20,0xff,0x3f};

static const uint8_t MinusSign2[] = {0xff,0x3f,0x01,0x20,0xfd,0x23,0xfd,0x23,0x01,0x20,0xff,0x3f};

static const uint8_t MinusSign3[] = {0xff,0x3f,0x01,0x20,0xfd,0x20,0xfd,0x20,0x01,0x20,0xff,0x3f};

static const uint8_t MinusSign4[] = {0xff,0x3f,0x01,0x20,0x1d,0x20,0x1d,0x20,0x01,0x20,0xff,0x3f};

static const uint8_t MinusSign5[] = {0xff,0x3f,0x01,0x20,0x01,0x20,0x01,0x20,0x01,0x20,0xff,0x3f};

static const uint8_t MinusSign6[] = {0xff,0x3f,0x01,0x20,0x01,0x2e,0x01,0x2e,0x01,0x20,0xff,0x3f};

static const uint8_t MinusSign7[] = {0xff,0x3f,0x01,0x20,0xc1,0x2f,0xc1,0x2f,0x01,0x20,0xff,0x3f};

static const uint8_t MinusSign8[] = {0xff,0x3f,0x01,0x20,0xf1,0x2f,0xf1,0x2f,0x01,0x20,0xff,0x3f};

static const uint8_t MinusSign9[] = {0xff,0x3f,0x01,0x20,0xf9,0x2f,0xf9,0x2f,0x01,0x20,0xff,0x3f};

